<html DIR="LTR" xmlns:MSHelp="http://msdn.microsoft.com/mshelp" xmlns:ddue="http://ddue.schemas.microsoft.com/authoring/2003/5" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:tool="http://www.microsoft.com/tooltip"><head><META HTTP-EQUIV="Content-Type" CONTENT="text/html; CHARSET=Windows-1252"></META><META NAME="save" CONTENT="history"></META><title>Leaked printer change notification handle detected</title><link rel="stylesheet" type="text/css" href="../local/Classic.css"></link><script src="../local/script.js"></script></head><body><div><input type="hidden" id="userDataCache" class="userDataStyle"></input><input type="hidden" id="hiddenScrollOffset"></input></div><img id="dropDownImage" style="display:none; height:0; width:0;" src="../local/drpdown.gif"></img><img id="dropDownHoverImage" style="display:none; height:0; width:0;" src="../local/drpdown_orange.gif"></img><img id="collapseImage" style="display:none; height:0; width:0;" src="../local/collapse.gif"></img><img id="expandImage" style="display:none; height:0; width:0;" src="../local/exp.gif"></img><img id="copyImage" style="display:none; height:0; width:0;" src="../local/copycode.gif"></img><img id="copyHoverImage" style="display:none; height:0; width:0;" src="../local/copycodeHighlight.gif"></img><div id="header"><table width="100%" id="topTable"><tr id="headerTableRow1"><td align="left"><span id="runningHeaderText"></span></td></tr><tr id="headerTableRow2"><td align="left"><span id="nsrTitle">Leaked printer change notification handle detected</span></td></tr><tr id="headerTableRow3"><td></td></tr></table></div><div id="mainSection"><div id="mainBody"><div id="allHistory" class="saveHistory" onsave="saveAll()" onload="loadAll()"></div><p></p><h2 class="heading">Application Verifier break message</h2><div id="sectionSection0" class="section"><content xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5"><p xmlns=""> Leaked printer change notification handle detected.</p></content></div><h2 class="heading">Probable cause</h2><div id="sectionSection1" class="section"><content xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5"><p xmlns=""> A printer change notification handle that was not closed was detected when the application exited. Most likely the thread that opened the handle did not call FindClosePrinterChangeNotification() to close the handle before the thread exited.</p></content></div><h2 class="heading">Troubleshooting steps</h2><div id="sectionSection2" class="section"><content xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5"><p xmlns="">To troubleshoot this stop: </p><ul xmlns=""><li class="unordered">
Determine the thread that opened the printer change notification handle.<br /><br /><ul><li class="unordered">
The second parameter of this stop provides the stack address. <br /><br /></li><li class="unordered">
Use the dps command to dump the stack trace. <br /><br /></li></ul></li><li class="unordered">
Find the first non-winspool and non-vfPrint module name that called vfPrint!VfHookFindFirstPrinterChangeNotification. This is typically found in the 4th stack frame. <br /><br /></li></ul><p xmlns="">For example:</p><div class="code" xmlns=""><span codeLanguage="other"><table width="100%" cellspacing="0" cellpadding="0"><tr><th> </th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif"></img>Copy Code</span></th></tr><tr><td colspan="2"><pre>=======================================
VERIFIER STOP 0000A001 : pid 0x13E4: Leaked printer change notification handle detected

        00000040 : Printer change notification handle being leaked.
        02946F50 : Initialization stack trace. Use dps to dump the stack trace if it is not NULL.
        00001040 : Thread id of the last thread using it.
        00000000 : Not used.
======================================
0:000&gt; dps 02946F50
02946f50  0243527a vfPrint!CItemTracker(void *)::Init+0x6a
02946f54  02434e30 vfPrint!CHandleTracker_t(void *)::Init+0x20 
02946f58  02434649 vfPrint!VfHookFindFirstPrinterChangeNotification+0x69 
02946f5c  7433e548 PRINTUI!VDataNotify::svNotifyStart+0x23 --------- this is the routine that is suspected of creating and not freeing a printer change notification handle </pre></td></tr></table></span></div></content></div><h2 class="heading">Information displayed by Application Verifier</h2><div id="sectionSection3" class="section"><content xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5"><p xmlns=""> Parameter 1 - Printer change notification handle being leaked.</p><p xmlns="">Parameter 2 - Initialization stack trace. Use dps to dump the stack trace if it is not NULL.</p><p xmlns="">Parameter 3 - Thread id of the last thread using it.</p><p xmlns="">Parameter 4 - Not used.</p></content></div><h2 class="heading">Additional information</h2><div id="sectionSection4" class="section"><content xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5"><p xmlns=""> Test Layer: PrintAPI</p><p xmlns="">Stop code: 0000A001</p><p xmlns="">Severity: Error</p><p xmlns="">One-time error: no</p><p xmlns="">Error report: Break</p><p xmlns="">Log to file: yes</p><p xmlns="">Create backtrace: yes</p></content></div><!--[if gte IE 5]>
			<tool:tip element="languageFilterToolTip" avoidmouse="false"/>
		<![endif]--></div><div id="footer"><p></p><hr></hr><br /><br /></div></div></body></html>