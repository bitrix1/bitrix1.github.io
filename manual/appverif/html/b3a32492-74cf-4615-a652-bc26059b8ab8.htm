<html DIR="LTR" xmlns:MSHelp="http://msdn.microsoft.com/mshelp" xmlns:ddue="http://ddue.schemas.microsoft.com/authoring/2003/5" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:tool="http://www.microsoft.com/tooltip"><head><META HTTP-EQUIV="Content-Type" CONTENT="text/html; CHARSET=Windows-1252"></META><META NAME="save" CONTENT="history"></META><title>Debugging Critical Section Errors</title><link rel="stylesheet" type="text/css" href="../local/Classic.css"></link><script src="../local/script.js"></script></head><body><div><input type="hidden" id="userDataCache" class="userDataStyle"></input><input type="hidden" id="hiddenScrollOffset"></input></div><img id="dropDownImage" style="display:none; height:0; width:0;" src="../local/drpdown.gif"></img><img id="dropDownHoverImage" style="display:none; height:0; width:0;" src="../local/drpdown_orange.gif"></img><img id="collapseImage" style="display:none; height:0; width:0;" src="../local/collapse.gif"></img><img id="expandImage" style="display:none; height:0; width:0;" src="../local/exp.gif"></img><img id="copyImage" style="display:none; height:0; width:0;" src="../local/copycode.gif"></img><img id="copyHoverImage" style="display:none; height:0; width:0;" src="../local/copycodeHighlight.gif"></img><div id="header"><table width="100%" id="topTable"><tr id="headerTableRow1"><td align="left"><span id="runningHeaderText"></span></td></tr><tr id="headerTableRow2"><td align="left"><span id="nsrTitle">Debugging Critical Section Errors</span></td></tr><tr id="headerTableRow3"><td></td></tr></table></div><div id="mainSection"><div id="mainBody"><div id="allHistory" class="saveHistory" onsave="saveAll()" onload="loadAll()"></div><h2 class="heading">!cs debugger extension</h2><div id="sectionSection0" class="section"><content xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5"><p xmlns="">!cs can be used in both user-mode debugger and kernel debugger to display information about critical sections in the current process. Matching symbols with type information is required, especially for ntdll.dll.</p><p xmlns="">The syntax for this extension is:</p><p xmlns="">cs [-s]                          - dump all the active critical sections in the current process.</p><p xmlns="">!cs [-s] address            - dump critical section at this address.</p><p xmlns="">!cs [-s] -d address        - dump critical section corresponding to DebugInfo at this address.</p><p xmlns="">-s will dump the critical section initialization stack trace if it's available.</p><p xmlns="">Examples:</p></content></div><h2 class="heading">Dump information about a critical section using its address</h2><div id="sectionSection1" class="section"><content xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5"><p xmlns="">0:001&gt; ! cs 0x7803B0F8</p><p xmlns="">Critical section   = 0x7803B0F8 (MSVCRT!__app_type+0x4)</p><p xmlns="">DebugInfo          = 0x6A262080</p><p xmlns="">NOT LOCKED</p><p xmlns="">LockSemaphore      = 0x0</p><p xmlns="">SpinCount          = 0x0</p></content></div><h2 class="heading">Dump information about a critical section using its address, including initialization stack trace</h2><div id="sectionSection2" class="section"><content xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5"><p xmlns="">0:001&gt; !cs -s 0x7803B0F8</p><p xmlns="">Critical section   = 0x7803B0F8 (MSVCRT!__app_type+0x4)</p><p xmlns="">DebugInfo          = 0x6A262080</p><p xmlns="">NOT LOCKED</p><p xmlns="">LockSemaphore      = 0x0</p><p xmlns="">SpinCount          = 0x0</p><p xmlns="">Stack trace for DebugInfo = 0x6A262080:</p><p xmlns="">0x6A2137BD: ntdll!RtlInitializeCriticalSectionAndSpinCount+0x9B</p><p xmlns="">0x6A207A4C: ntdll!LdrpCallInitRoutine+0x14</p><p xmlns="">0x6A205569: ntdll!LdrpRunInitializeRoutines+0x1D9</p><p xmlns="">0x6A20DCE1: ntdll!LdrpInitializeProcess+0xAE5</p></content></div><h2 class="heading">Dump information about a critical section using its debug info address</h2><div id="sectionSection3" class="section"><content xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5"><p xmlns="">0:001&gt; !cs -d 0x6A262080</p><p xmlns="">DebugInfo          = 0x6A262080</p><p xmlns="">Critical section   = 0x7803B0F8 (MSVCRT!__app_type+0x4)</p><p xmlns="">NOT LOCKED</p><p xmlns="">LockSemaphore      = 0x0</p><p xmlns="">SpinCount          = 0x0</p></content></div><h2 class="heading">Dump information about a critical section using its debug info address, including initialization stack trace</h2><div id="sectionSection4" class="section"><content xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5"><p xmlns="">0:001&gt; !cs -s -d 0x6A262080</p><p xmlns="">DebugInfo          = 0x6A262080</p><p xmlns="">Critical section   = 0x7803B0F8 (MSVCRT!__app_type+0x4)</p><p xmlns="">NOT LOCKED</p><p xmlns="">LockSemaphore      = 0x0</p><p xmlns="">SpinCount          = 0x0</p><p xmlns="">Stack trace for DebugInfo = 0x6A262080:</p><p xmlns="">0x6A2137BD: ntdll!RtlInitializeCriticalSectionAndSpinCount+0x9B</p><p xmlns="">0x6A207A4C: ntdll!LdrpCallInitRoutine+0x14</p><p xmlns="">0x6A205569: ntdll!LdrpRunInitializeRoutines+0x1D9</p><p xmlns="">0x6A20DCE1: ntdll!LdrpInitializeProcess+0xAE</p></content></div><h2 class="heading">Dump information about all the active critical sections in the current process</h2><div id="sectionSection5" class="section"><content xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5"><p xmlns="">0:001&gt; !cs</p><p xmlns="">-----------------------------------------</p><p xmlns="">DebugInfo          = 0x6A261D60</p><p xmlns="">Critical section   = 0x6A262820 (ntdll!RtlCriticalSectionLock+0x0)</p><p xmlns="">LOCKED</p><p xmlns="">LockCount          = 0x0</p><p xmlns="">OwningThread       = 0x460</p><p xmlns="">RecursionCount     = 0x1</p><p xmlns="">LockSemaphore      = 0x0</p><p xmlns="">SpinCount          = 0x0</p><p xmlns="">-----------------------------------------</p><p xmlns="">DebugInfo          = 0x6A261D80</p><p xmlns="">Critical section   = 0x6A262580 (ntdll!DeferedCriticalSection+0x0)</p><p xmlns="">NOT LOCKED</p><p xmlns="">LockSemaphore      = 0x7FC</p><p xmlns="">SpinCount          = 0x0</p><p xmlns="">-----------------------------------------</p><p xmlns="">DebugInfo          = 0x6A262600</p><p xmlns="">Critical section   = 0x6A26074C (ntdll!LoaderLock+0x0)</p><p xmlns="">NOT LOCKED</p><p xmlns="">LockSemaphore      = 0x0</p><p xmlns="">SpinCount          = 0x0</p><p xmlns="">.....</p></content></div><h2 class="heading">Dump information about all the active critical sections in the current process, including initialization stack trace</h2><div id="sectionSection6" class="section"><content xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5"><p xmlns="">0:001&gt; !cs -s</p><p xmlns="">...</p><p xmlns="">-----------------------------------------</p><p xmlns="">DebugInfo          = 0x6A261EA0</p><p xmlns="">Critical section   = 0xA8001C (+0xA8001C)</p><p xmlns="">NOT LOCKED</p><p xmlns="">LockSemaphore      = 0x0</p><p xmlns="">SpinCount          = 0x0</p><p xmlns="">No stack trace saved</p><p xmlns="">-----------------------------------------</p><p xmlns="">DebugInfo          = 0x6A261EC0</p><p xmlns="">Critical section   = 0x6A263560 (ntdll!RtlpDphTargetDllsLock+0x0)</p><p xmlns="">NOT LOCKED</p><p xmlns="">LockSemaphore      = 0x0</p><p xmlns="">SpinCount          = 0x0</p><p xmlns="">No stack trace saved</p><p xmlns="">-----------------------------------------</p><p xmlns="">DebugInfo          = 0x6A261EE0</p><p xmlns="">Critical section   = 0xA90608 (+0xA90608)</p><p xmlns="">NOT LOCKED</p><p xmlns="">LockSemaphore      = 0x7EC</p><p xmlns="">SpinCount          = 0x0</p><p xmlns="">Stack trace for DebugInfo = 0x6A261EE0:</p><p xmlns="">0x6A2137BD: ntdll!RtlInitializeCriticalSectionAndSpinCount+0x9B</p><p xmlns="">0x6A20B0DC: ntdll!CsrpConnectToServer+0x1BE</p><p xmlns="">0x6A20B2AA: ntdll!CsrClientConnectToServer+0x148</p><p xmlns="">0x77DBE83F: KERNEL32!BaseDllInitialize+0x11F</p><p xmlns="">0x6A207A4C: ntdll!LdrpCallInitRoutine+0x14</p><p xmlns="">0x6A205569: ntdll!LdrpRunInitializeRoutines+0x1D9</p><p xmlns="">0x6A20DCE1: ntdll!LdrpInitializeProcess+0xAE5</p><p xmlns="">-----------------------------------------</p><p xmlns="">DebugInfo          = 0x6A261F00</p><p xmlns="">Critical section   = 0x77E1AEB8 (KERNEL32!BaseDllRegistryCache+0x18)</p><p xmlns="">NOT LOCKED</p><p xmlns="">LockSemaphore      = 0x0</p><p xmlns="">SpinCount          = 0x0</p><p xmlns="">Stack trace for DebugInfo = 0x6A261F00:</p><p xmlns="">0x6A2137BD: ntdll!RtlInitializeCriticalSectionAndSpinCount+0x9B</p><p xmlns="">0x6A207A4C: ntdll!LdrpCallInitRoutine+0x14</p><p xmlns="">0x6A205569: ntdll!LdrpRunInitializeRoutines+0x1D9</p><p xmlns="">0x6A20DCE1: ntdll!LdrpInitializeProcess+0xAE5</p><p xmlns=""></p></content></div><!--[if gte IE 5]>
			<tool:tip element="languageFilterToolTip" avoidmouse="false"/>
		<![endif]--></div><div id="footer"><p></p><hr></hr><br /><br /></div></div></body></html>