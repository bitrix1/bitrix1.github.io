<html DIR="LTR" xmlns:MSHelp="http://msdn.microsoft.com/mshelp" xmlns:ddue="http://ddue.schemas.microsoft.com/authoring/2003/5" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:tool="http://www.microsoft.com/tooltip"><head><META HTTP-EQUIV="Content-Type" CONTENT="text/html; CHARSET=Windows-1252"></META><META NAME="save" CONTENT="history"></META><title>Debugger Questions</title><link rel="stylesheet" type="text/css" href="../local/Classic.css"></link><script src="../local/script.js"></script></head><body><div><input type="hidden" id="userDataCache" class="userDataStyle"></input><input type="hidden" id="hiddenScrollOffset"></input></div><img id="dropDownImage" style="display:none; height:0; width:0;" src="../local/drpdown.gif"></img><img id="dropDownHoverImage" style="display:none; height:0; width:0;" src="../local/drpdown_orange.gif"></img><img id="collapseImage" style="display:none; height:0; width:0;" src="../local/collapse.gif"></img><img id="expandImage" style="display:none; height:0; width:0;" src="../local/exp.gif"></img><img id="copyImage" style="display:none; height:0; width:0;" src="../local/copycode.gif"></img><img id="copyHoverImage" style="display:none; height:0; width:0;" src="../local/copycodeHighlight.gif"></img><div id="header"><table width="100%" id="topTable"><tr id="headerTableRow1"><td align="left"><span id="runningHeaderText"></span></td></tr><tr id="headerTableRow2"><td align="left"><span id="nsrTitle">Debugger Questions</span></td></tr><tr id="headerTableRow3"><td></td></tr></table></div><div id="mainSection"><div id="mainBody"><div id="allHistory" class="saveHistory" onsave="saveAll()" onload="loadAll()"></div><p>Following are the list of questions received regarding the debugger. Click on the question to see the response: </p><p><a href="#error">Why did I receive an error telling me I need a debugger?</a></p><p><a href="#running">How do I run my application under a debugger?</a></p><p><a href="#help">How do I get help with a debugger?</a></p><p><a href="#stackexpansion">How do I test stack expansion without any other instrumentation?</a></p><p><a href="#getoverflow">Stack check is on for my service, I can start/stop the service, but get an overflow</a></p><p><a href="#avrf">When using !avrf extension I get 'Application verifier is not enabled for this process...'</a></p><p></p><a name="error" xmlns:ms="urn:schemas-microsoft-com:xslt" xmlns:cs="urn:the-xml-files:xslt-cs"></a><a name="error"></a><h2 class="heading">Why did I receive an error telling me I need a debugger?</h2><div id="sectionSection0" class="section"><content xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5"><p xmlns="">The Basics verification layer within Application Verifier require that you run your application under a debugger. If you do not have a debugger associated to the application prior to selecting the test, you will receive a dialog reminding you that you will need to run your application under a debugger in order to obtain the logged information. </p></content></div><a name="running" xmlns:ms="urn:schemas-microsoft-com:xslt" xmlns:cs="urn:the-xml-files:xslt-cs"></a><a name="running"></a><h2 class="heading">How do I run my application under a debugger?</h2><div id="sectionSection1" class="section"><content xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5"><p xmlns="">See the Debugger install and setup topic. If this doesn't address your question, visit <a href="http://go.microsoft.com/fwlink/?linkid=8708" target="_blank" class="external" alt="">http://go.microsoft.com/fwlink/?linkid=8708</a>.</p></content></div><a name="help" xmlns:ms="urn:schemas-microsoft-com:xslt" xmlns:cs="urn:the-xml-files:xslt-cs"></a><a name="help"></a><h2 class="heading">How do I get help with a debugger?</h2><div id="sectionSection2" class="section"><content xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5"><p xmlns="">Visit <a href="http://go.microsoft.com/fwlink/?linkid=8708" target="_blank" class="external" alt="">http://go.microsoft.com/fwlink/?linkid=8708</a>. </p></content></div><a name="stackexpansion" xmlns:ms="urn:schemas-microsoft-com:xslt" xmlns:cs="urn:the-xml-files:xslt-cs"></a><a name="stackexpansion"></a><h2 class="heading">How do I test stack expansion without any other instrumentation?</h2><div id="sectionSection3" class="section"><content xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5"><p xmlns="">In general, stack expansion should be really tested in isolation from other verification layers, including heap. The reason is the following: each verification layers "thunks" an API or an exported point with some routine. </p><p xmlns="">For example, a call to CreateFileA, will be a call to appvocre!NS_SecurityChecks::CreateFileA, that might call appvcore!NS_FillePaths::CreateFileA that might call kernel32!CreateFileA, that might call verifier!AVrfpNtCreateFile, that will call ntdll!NtCreateFile. You can see that the instrumentation has added 3 more "stacked" function calls, each one of them may and will consume more stack. </p><p xmlns="">In the case below, the LH-verifier.dll is "thunking" every DllMain, and the "instrumented" heap code path will add more stack usage. Since the injected thread from the debugger does not use the IMAGE_NT_HEADERS defaults, the initially committed stack will not be enough to complete the APC state of a thread (a thread in the APC state executed the initialization code). </p><p xmlns="">If you want to use Stack-Ckecs, probably the only other verification layer you should use if FirstChanceAccessViolation. </p></content></div><a name="getoverflow" xmlns:ms="urn:schemas-microsoft-com:xslt" xmlns:cs="urn:the-xml-files:xslt-cs"></a><a name="getoverflow"></a><h2 class="heading">Stack check is on for my service; I can start/stop the service, but get an overflow</h2><div id="sectionSection4" class="section"><content xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5"><p xmlns="">I turned the stack check on for my service. I am able to start and stop the service. But if I start a remote and connect a client to the remote and hit ctrl-brk to stop in the client debugger I get an overflow stop with the stack. Why? </p><p xmlns="">Microsoft Windows XP does not have a fix for DbgUiIssueRemoteBreakin to create the injected thread with a big enough stack for the page-heap code. </p><p xmlns="">Instead, you can do one of the following: </p><ul xmlns=""><li class="unordered">
Use a more modern operating system. <br /><br /></li><li class="unordered">
Test the stack expansion without any other instrumentation (recommended, since superimposition of effects is non linear).<br /><br /></li><li class="unordered">
Debug from KD, where there is no need to inject a thread to break in the debugger.<br /><br /></li><li class="unordered">
Use suspensive non-invasive debugging. <br /><br /></li></ul></content></div><a name="avrf" xmlns:ms="urn:schemas-microsoft-com:xslt" xmlns:cs="urn:the-xml-files:xslt-cs"></a><a name="avrf"></a><h2 class="heading">When using !avrf extension I get 'Application verifier is not enabled for this process...'</h2><div id="sectionSection5" class="section"><content xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5"><p xmlns="">The complete error received:</p><p xmlns="">Application verifier is not enabled for this process. Use appverif.exe tool to enable it.</p><p xmlns="">You probably have just the shim verification layers enabled and/or the heap in "pure" mode enabled. These are some of the possible causes. </p><p xmlns="">Without any detail of what exactly was enabled before and what was enabled after the change (and what the change was), it is not possible to say anything meaningful. </p></content></div><!--[if gte IE 5]>
			<tool:tip element="languageFilterToolTip" avoidmouse="false"/>
		<![endif]--></div><div id="footer"><p></p><hr></hr><br /><br /></div></div></body></html>