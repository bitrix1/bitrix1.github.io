<html DIR="LTR" xmlns:MSHelp="http://msdn.microsoft.com/mshelp" xmlns:ddue="http://ddue.schemas.microsoft.com/authoring/2003/5" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:tool="http://www.microsoft.com/tooltip"><head><META HTTP-EQUIV="Content-Type" CONTENT="text/html; CHARSET=Windows-1252"></META><META NAME="save" CONTENT="history"></META><title>The SRW lock is being acquired recursively by the same thread</title><link rel="stylesheet" type="text/css" href="../local/Classic.css"></link><script src="../local/script.js"></script></head><body><div><input type="hidden" id="userDataCache" class="userDataStyle"></input><input type="hidden" id="hiddenScrollOffset"></input></div><img id="dropDownImage" style="display:none; height:0; width:0;" src="../local/drpdown.gif"></img><img id="dropDownHoverImage" style="display:none; height:0; width:0;" src="../local/drpdown_orange.gif"></img><img id="collapseImage" style="display:none; height:0; width:0;" src="../local/collapse.gif"></img><img id="expandImage" style="display:none; height:0; width:0;" src="../local/exp.gif"></img><img id="copyImage" style="display:none; height:0; width:0;" src="../local/copycode.gif"></img><img id="copyHoverImage" style="display:none; height:0; width:0;" src="../local/copycodeHighlight.gif"></img><div id="header"><table width="100%" id="topTable"><tr id="headerTableRow1"><td align="left"><span id="runningHeaderText"></span></td></tr><tr id="headerTableRow2"><td align="left"><span id="nsrTitle">The SRW lock is being acquired recursively by the same thread</span></td></tr><tr id="headerTableRow3"><td></td></tr></table></div><div id="mainSection"><div id="mainBody"><div id="allHistory" class="saveHistory" onsave="saveAll()" onload="loadAll()"></div><p></p><h2 class="heading">Application Verifier break message</h2><div id="sectionSection0" class="section"><content xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5"><p xmlns="">The SRW lock is being acquired recursively by the same thread.</p></content></div><h2 class="heading">Probable cause</h2><div id="sectionSection1" class="section"><content xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5"><p xmlns="">This stop is generated if an SRW lock is being acquired recursively by the same thread.</p></content></div><h2 class="heading">Information displayed by Application Verifier</h2><div id="sectionSection2" class="section"><content xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5"><p xmlns="">Parameter 1 – SRW lock address</p><p xmlns="">Parameter 2 – Address of the first “acquire” stack trace.</p><p xmlns="">Parameter 3 – Not used</p><p xmlns="">Parameter 4 – Not used</p></content></div><h2 class="heading">Additional Information</h2><div id="sectionSection3" class="section"><content xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5"><p xmlns="">Verifier Stop Code 0253.</p><p xmlns="">If you acquire an SRW lock recursively, the result can be a deadlock and a thread that blocks indefinitely. Recursive acquisition of an SRW lock in exclusive mode will cause a deadlock. Recursive acquisition of an SRW lock in shared mode will cause a deadlock when there is a thread waiting for exclusive access. Consider the example below.</p><ol class="ordered" xmlns=""><li>
							Thread A acquires the SRW lock in shared mode.<br /><br /></li><li>
							Thread B tries to acquire the SRW lock in exclusive mode and waits.<br /><br /></li><li>
							Thread A tries to acquire the SRW lock in shared mode recursively. This will be successful as long as there is no exclusive waiter (in this case B). Since SRW locks do not have writer starvation, thread A waits behind thread B. Now Thread B is waiting for Thread A, which is in turn waiting for Thread B, This is a circular wait, which results in a deadlock.<br /><br /></li></ol><p xmlns="">To debug this stop, use the following debugger commands:</p><p xmlns="">kb - to get the current stack trace. The stack trace shows you where the SRW lock is being acquired recursively.</p><p xmlns="">dps parameter 2 – to get the first “acquire” stack trace. The first “acquire” stack trace shows you where the lock was acquired.</p></content></div><!--[if gte IE 5]>
			<tool:tip element="languageFilterToolTip" avoidmouse="false"/>
		<![endif]--></div><div id="footer"><p></p><hr></hr><br /><br /></div></div></body></html>