<html DIR="LTR" xmlns:MSHelp="http://msdn.microsoft.com/mshelp" xmlns:ddue="http://ddue.schemas.microsoft.com/authoring/2003/5" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:tool="http://www.microsoft.com/tooltip"><head><META HTTP-EQUIV="Content-Type" CONTENT="text/html; CHARSET=Windows-1252"></META><META NAME="save" CONTENT="history"></META><title>Attempt to use a closed printer handle</title><link rel="stylesheet" type="text/css" href="../local/Classic.css"></link><script src="../local/script.js"></script></head><body><div><input type="hidden" id="userDataCache" class="userDataStyle"></input><input type="hidden" id="hiddenScrollOffset"></input></div><img id="dropDownImage" style="display:none; height:0; width:0;" src="../local/drpdown.gif"></img><img id="dropDownHoverImage" style="display:none; height:0; width:0;" src="../local/drpdown_orange.gif"></img><img id="collapseImage" style="display:none; height:0; width:0;" src="../local/collapse.gif"></img><img id="expandImage" style="display:none; height:0; width:0;" src="../local/exp.gif"></img><img id="copyImage" style="display:none; height:0; width:0;" src="../local/copycode.gif"></img><img id="copyHoverImage" style="display:none; height:0; width:0;" src="../local/copycodeHighlight.gif"></img><div id="header"><table width="100%" id="topTable"><tr id="headerTableRow1"><td align="left"><span id="runningHeaderText"></span></td></tr><tr id="headerTableRow2"><td align="left"><span id="nsrTitle">Attempt to use a closed printer handle</span></td></tr><tr id="headerTableRow3"><td></td></tr></table></div><div id="mainSection"><div id="mainBody"><div id="allHistory" class="saveHistory" onsave="saveAll()" onload="loadAll()"></div><p></p><h2 class="heading">Application Verifier break message</h2><div id="sectionSection0" class="section"><content xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5"><p xmlns=""> Attempt to use a closed printer handle</p></content></div><h2 class="heading">Probable cause</h2><div id="sectionSection1" class="section"><content xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5"><p xmlns=""> A printer handle was used after it had been closed.</p></content></div><h2 class="heading">Troubleshooting steps</h2><div id="sectionSection2" class="section"><content xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5"><p xmlns="">To identify the routine that tried to use the closed printer handle, dump the current stack trace by using the ‘k' command in the debugger.</p><p xmlns="">To dump the stack trace of the routine that closed the handle, use the dps command with the second parameter of the stop.</p><p xmlns="">For example:</p><div class="code" xmlns=""><span codeLanguage="other"><table width="100%" cellspacing="0" cellpadding="0"><tr><th> </th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif"></img>Copy Code</span></th></tr><tr><td colspan="2"><pre>=======================================
VERIFIER STOP 0000A005 : pid 0x884: Attempt to use a closed printer handle
        035C6F8C : Printer handle being accessed.
        02902F50 : Stack trace of the closing. Use dps to dump the stack trace if it is not NULL.
        00000000 : Not used.
        00000000 : Not used.
=======================================
0:000&gt; k 
ChildEBP RetAddr
0006fda0 024124f2 ntdll!DbgBreakPoint
0006fdd4 024134de vfprint!CResourceUsageMgr(void *,CHandleTracker_t(void *) )::ClosedHandleCheck+0xa2
0006fe84 010026f2 vfprint!VfHookClosePrinter+0x16e
0006fe94 0100266c UnitTest! TestFunc +0x32      ------------------- touching already closed handle!! This is a bug.
0006ff5c 01003eb1 UnitTest!wmain+0x34c   
0006ffa0 77e4ee88 UnitTest!__tmainCRTStartup+0x10f
0006ffac 77f44f2a KERNEL32!BaseThreadInitThunk+0x12
0006ffec 00000000 ntdll!RtlSetThreadPreferredUILanguages+0x5c1

0:000&gt; dps 2902f50
02902f50  0241e9db vfprint!CaptureStack+0x1b
02902f54  024133d7 vfprint!VfHookClosePrinter+0x67
02902f58  010026e9 UnitTest!TestFunc+0x29  ---------------- This is the code that closed the handle.
02902f5c  0100266c UnitTest!wmain+0x34c
02902f60  01003eb1 UnitTest!__tmainCRTStartup+0x10f
02902f64  77e4ee88 KERNEL32!BaseThreadInitThunk+0xe
02902f68  77f44f2a ntdll!_RtlUserThreadStart+0x23</pre></td></tr></table></span></div></content></div><h2 class="heading">Information displayed by Application Verifier</h2><div id="sectionSection3" class="section"><content xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5"><p xmlns=""> Parameter 1 - Printer handle being accessed.</p><p xmlns="">Parameter 2 - Stack trace of the closing. Use dps to dump the stack trace if it is not NULL.</p><p xmlns="">Parameter 3 - Not used.</p><p xmlns="">Parameter 4 - Not used.</p></content></div><h2 class="heading">Additional information</h2><div id="sectionSection4" class="section"><content xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5"><p xmlns=""> Test Layer: PrintAPI</p><p xmlns="">Stop code: 0000A005</p><p xmlns="">Severity: Error</p><p xmlns="">One-time error: no</p><p xmlns="">Error report: Break</p><p xmlns="">Log to file: yes</p><p xmlns="">Create backtrace: yes</p></content></div><!--[if gte IE 5]>
			<tool:tip element="languageFilterToolTip" avoidmouse="false"/>
		<![endif]--></div><div id="footer"><p></p><hr></hr><br /><br /></div></div></body></html>